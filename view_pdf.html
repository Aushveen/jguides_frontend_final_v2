<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Your PDF</title>
    <!-- ICONSCOUT CDN -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v2.1.6/css/unicons.css">

    <!-- GOOGLE FONTS (MONTSERRAT) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/viewYourPDF.css">

    <style>
        body { background-image: url("./images/bg-texture.png") }
    </style>
</head>
<body>
    <nav>
        <div class="container nav__container">
            <a href="index.html#"><img src="./images/jguidesnewlogotransparent-09.png" alt="J-GUIDES Logo" class="nav__logo-image"></a>
            <ul class="nav__menu">
                  <li><a href="index.html#">Home</a></li>
                  <li><a href="index.html#about">About</a></li>
                  <li><a href="index.html#ebook">J-Guide</a></li>
                  <li><a href="index.html#faq">FAQ</a></li>
                  <li><a href="index.html#testimonials">Testimonials</a></li>
                  <li><a href="view_pdf.html">View Your J-Guide</a></li>
                  <li><a href="contact.html">Contact</a></li>
              </ul>
              <button id="open-menu-btn"><i class="uil uil-bars"></i></button>
              <button id="close-menu-btn"><i class="uil uil-multiply"></i></button>
          </div>
    </nav>
    <!--========================== END OF NAVBAR ============================-->

    <section class="view-pdf">
        <div class="container view-pdf__container">
            <h2>View Your PDF</h2>
            <form id="viewPdfForm" class="view-pdf__form">
                <input type="email" name="email" placeholder="Enter your order email" required>
                <input type="text" name="orderId" placeholder="Enter your order ID" required>
                <button type="submit" class="btn btn-primary">View PDF</button>
            </form>
        </div>
        <div id="image-container" class="image-container">
            <p>No image to display</p>
        </div>
        <div id="page-number" class="page-number">
            <p>Page 0 of 0</p>
        </div>
        <div id="links-container" class="links-container"></div>
        <div class="nav-buttons">
            <button class="btn-nav" onclick="goLeft()">Go Left</button>
            <button class="btn-nav" onclick="goRight()">Go Right</button>
        </div>
    </section>
    
    <footer>
        <div class="container footer__container">
            <div class="footer__1">
                <a href="index.html#" class="footer__logo"><img src="./images/jguidesnewlogotransparent-09.png" alt="J-GUIDES Logo" class="footer__logo-image"></a>
            </div>
            <div class="footer__2">
                <h4>Quick Links</h4>
                <ul class="permalinks">
                    <li><a href="index.html#">Home</a></li>
                    <li><a href="index.html#about">About</a></li>
                    <li><a href="index.html#ebook">J-Guide</a></li>
                    <li><a href="contact.html#">Contact</a></li>
                </ul>
            </div>
            <div class="footer__3">
                <h4>Privacy</h4>
                <ul class="privacy">
                    <li><a href="privacy_refunds.html">Privacy Policy</a></li>
                    <li><a href="privacy_refunds.html">Refund Policy</a></li>
                </ul>
            </div>
            <div class="footer__4">
                <h4>Contact Us</h4>
                <div>
                    <p>+1 123 123 1221</p>
                    <p>josh@jguides.com</p>
                </div>
                <ul class="footer__socials">
                    <li><a href="https://www.facebook.com/profile.php?id=61561265210229" target="_blank"><i class="uil uil-facebook-f"></i></a></li>
                    <li><a href="https://www.instagram.com/j.guides/" target="_blank"><i class="uil uil-instagram-alt"></i></a></li>
                </ul>
            </div>
        </div>
        <div class="footer__copyright">
            <small>Copyright &copy; 2024</small>
        </div>
    </footer>
    <script src="./main.js"></script>
    <script>
        let images = [];
        let currentIndex = 0;
        let currentOrderId = null;

        const links = {
            22: '<a href="https://beinvolved.indiana.edu/?_gl=1*6fojem*_ga*MTUyNDM2MjQyMS4xNzAzMTc0MDYx*_ga_61CH0D2DQW*MTcwNTk2MjI5Ny44LjEuMTcwNTk2MzQ2Ni40OS4wLjA" class="btn btn-primary" target="_blank">BeINvolved</a>',
            23: `
              <a href="https://studentlife.indiana.edu/involvement-belonging/student-involvement-leadership/leadership-programs/index.html" class="btn btn-primary" target="_blank">Leadership Programs 1</a><br>
                <a href="https://studentlife.indiana.edu/get-involved/leadership-programs/index.html" class="btn btn-primary" target="_blank">Leadership Programs 2</a><br>
                <a href="https://iustudentgovernment.indiana.edu/" class="btn btn-primary" target="_blank">IU Student Government</a><br>
                <a href="https://imu.indiana.edu/union-board/index.html" class="btn btn-primary" target="_blank">Union Board</a><br>
                <a href="https://fundiu.indiana.edu/" class="btn btn-primary" target="_blank">Funding Board</a><br>
                <a href="https://studentaffairs.indiana.edu/get-involved/outdoor-adventures/join-the-team.html" class="btn btn-primary" target="_blank">IU Outdoor Adventures</a><br>
                <a href="https://jobs.iu.edu/" class="btn btn-primary" target="_blank">Student Employment</a><br>
                <a href="https://studentaffairs.indiana.edu/get-involved/leadership-programs/index.html" class="btn btn-primary" target="_blank">Peer Fac</a>
    `,
            24: '<a href="https://luddy.indiana.edu/academics/align/innovation-entrepreneurship/index.html?_gl=1*1h5m7gr*_ga*MTIyNzg5MTgxOS4xNjc4MjkwMTI3*_ga_61CH0D2DQW*MTcwNTk2NTU3NC43OS4xLjE3MDU5NjU2NDguNDYuMC4w&_ga=2.241427527.418170106.1705944480-1227891819.1678290127" class="btn btn-primary" target="_blank">Shoemaker Innovation Center</a><br><a href="https://kelley.iu.edu/programs/undergrad/academics/workshops/index.html" class="btn btn-primary" target="_blank">Kelley Workshops</a>',
            25: `
        <a href="https://studentaffairs.indiana.edu/get-involved/sororities-fraternities/joining/index.html" target="_blank" class="btn btn-primary">Sororities & Fraternities</a><br>
        <a href="https://beinvolved.indiana.edu/organization/ifc" target="_blank" class="btn btn-primary">Interfraternity Council</a><br>
        <a href="https://iumcgc.wixsite.com/mysite" target="_blank" class="btn btn-primary">Multi-Cultural Greek Council</a><br>
        <a href="https://beinvolved.indiana.edu/organization/nphc" target="_blank" class="btn btn-primary">National Pan-Hellenic Council</a><br>
        <a href="https://www.panhellenicindiana.org/" target="_blank" class="btn btn-primary">Panhellenic Association</a>
                `,
            27: '<a href="https://recsports.indiana.edu/activites/courts.html" target="_blank" class="btn btn-primary">Courts and Fields</a><br><a href="https://imu.indiana.edu/activities-services/bowling-billiards/index.html" target="_blank" class="btn btn-primary">Bowling and Billiards</a>',
            32: '<a href="https://1drv.ms/x/s!AlvCStp-8HUNhBDQN33T-2vmyDUf?e=7EP5IH" target="_blank" class="btn btn-primary">Class Schedule Builder</a><br><a href="https://1drv.ms/x/s!AlvCStp-8HUNhBIMfgrpn0IScicW?e=SWUbO7" target="_blank" class="btn btn-primary">Weekly Planner</a>',
            33: `
        <a href="https://vimeo.com/user221399637/j-guides1" target="_blank" class="btn btn-primary">CLICK ME - WALK-THROUGH 1</a><br>
        <a href="https://vimeo.com/user221399637/j-guides2" target="_blank" class="btn btn-primary">CLICK ME - WALK-THROUGH 2</a>
                `,
            34: `
        <a href="https://vimeo.com/user221399637/j-guides3" target="_blank" class="btn btn-primary">CLICK ME - WALK-THROUGH 3</a>
                 `,
            37: '<a href="https://www.cdc.gov/vaccines/schedules/downloads/teen/parent-version-schedule-7-18yrs.pdf" target="_blank" class="btn btn-primary">Download CDCâ€™s 2024 Recommended Immunizations</a>',
            38: '<a href="https://redtutoring.com/" target="_blank" class="btn btn-primary">Red Tutoring</a><br><a href="https://campusts.com/?gclid=Cj0KCQjwncWvBhD_ARIsAEb2HW_vbAaR7PIlSVQXqKNisTGwDtrWbt61GeCvNWgzQaVxJeZGQx8Dk2kaAtd_EALw_wcB" target="_blank" class="btn btn-primary">Campus Tutoring</a><br><a href="https://bloomingtontutors.com/" target="_blank" class="btn btn-primary">Bloomington Tutors</a><br><a href="https://bschooltutors.com/" target="_blank" class="btn btn-primary">B-School Tutors</a>',
            43: '<a href="http://www.twiceexceptional.us" target="_blank" class="btn btn-primary">Twice Exceptional</a>'
        };

        document.getElementById('viewPdfForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const email = event.target.email.value.trim();
            const orderId = event.target.orderId.value.trim();

            currentOrderId = orderId;

            try {
                // Validate the order
                const orderResponse = await fetch(`https://jguides.onrender.com/orders/${orderId}/${email}`);
                if (orderResponse.ok) {
                    const order = await orderResponse.json();
                    const ebookId = order.ebookID;

                    // Fetch the images
                    const imagesResponse = await fetch(`https://jguides.onrender.com/ebooks/${ebookId}/pdf/${orderId}`);
                    if (imagesResponse.ok) {
                        images = await imagesResponse.json();
                        if (images.length > 0) {
                            currentIndex = 0;
                            displayImage();
                        } else {
                            document.getElementById('image-container').innerHTML = '<p>No images found</p>';
                        }
                    } else {
                        const errorMessage = await imagesResponse.text();
                        console.error(`Failed to retrieve images: ${errorMessage}`);
                        alert(`Failed to retrieve images: ${errorMessage}`);
                    }
                } else {
                    const errorMessage = await orderResponse.text();
                    alert(`Invalid order, please make sure you email address and order ID are right: ${errorMessage}`);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Server is down, let support know server is down.');
            }
        });

        function displayImage() {
            const imageContainer = document.getElementById('image-container');
            const pageNumber = document.getElementById('page-number');
            const linksContainer = document.getElementById('links-container');

            imageContainer.innerHTML = '';
            const img = document.createElement('img');
            img.src = 'data:image/jpeg;base64,' + images[currentIndex];
            imageContainer.appendChild(img);
            pageNumber.innerHTML = `<p>Page ${currentIndex + 1} of ${images.length}</p>`;

            // Display links if they exist for the current page
            const pageLinks = links[currentIndex + 1];
            if (pageLinks) {
                linksContainer.innerHTML = pageLinks;
            } else {
                linksContainer.innerHTML = '';
            }
        }

        function goRight() {
            if (images.length > 0) {
                currentIndex = (currentIndex + 1) % images.length;
                displayImage();
            }
        }

        function goLeft() {
            if (images.length > 0) {
                currentIndex = (currentIndex - 1 + images.length) % images.length;
                displayImage();
            }
        }

        window.addEventListener('beforeunload', async function () {
            if (currentOrderId) {
                try {
                    await fetch(`https://jguides.onrender.com/ebooks/reset/${currentOrderId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                } catch (error) {
                    console.error('Error resetting view count:', error);
                }
            }
        });
    </script>
</body>
</html>
